# PWA Implementation

This frontend is now a Progressive Web App (PWA), which means it can be installed on devices and work offline.

## Features

- **Installable**: Users can install the app on their devices (desktop and mobile)
- **Offline Support**: The app works offline with cached content
- **App-like Experience**: Runs in standalone mode without browser UI
- **Fast Loading**: Cached assets for faster load times
- **Push Notifications Ready**: Infrastructure in place for future push notification support

## What's Included

### 1. Service Worker
- Automatically generated by `next-pwa`
- Handles offline caching
- Manages asset caching strategies
- Located at `/public/sw.js` (auto-generated, not committed to git)

### 2. Web App Manifest
- Location: `/public/manifest.json`
- Defines app name, icons, colors, and metadata
- Enables "Add to Home Screen" functionality

### 3. PWA Icons
- `icon-192.png`: Used for home screen and smaller displays
- `icon-512.png`: Used for larger displays and splash screens
- Both generated from the main `icon.png`

### 4. Install Prompt Component
- Component: `/components/install-pwa.tsx`
- Shows a native-feeling prompt to install the app
- Remembers if user dismisses it
- Only shows on supported browsers

### 5. Offline Page
- Location: `/app/offline/page.tsx`
- Displayed when user is offline and tries to access uncached content
- Provides helpful information about offline capabilities

## Caching Strategies

The service worker uses different caching strategies for different resource types:

- **CacheFirst**: Google Fonts, Audio, Video (long-lived static assets)
- **StaleWhileRevalidate**: Images, CSS, JS, Fonts (frequently updated assets)
- **NetworkFirst**: API calls, Dynamic content (prioritize fresh data)

## Testing PWA

### Local Development
The PWA is disabled in development mode for easier debugging. To test:

1. Build the production version:
   ```bash
   pnpm build:frontend
   ```

2. Start the production server:
   ```bash
   pnpm start:frontend
   ```

3. Open in browser: `http://localhost:3000`

### Testing Installation

**Desktop (Chrome/Edge):**
1. Click the install icon in the address bar
2. Or use the install prompt that appears

**Mobile (Chrome/Safari):**
1. Android Chrome: Tap "Add to Home Screen" from browser menu
2. iOS Safari: Tap Share > "Add to Home Screen"

### Testing Offline Mode

1. Install the app or open in browser
2. Navigate through a few pages
3. Open DevTools > Application > Service Workers
4. Check "Offline" checkbox
5. Try navigating - cached pages should still work

## Configuration

### Updating Manifest

Edit `/public/manifest.json` to change:
- App name and short name
- Theme colors
- Icons
- App shortcuts

### Updating Caching Strategy

Edit `/next.config.ts`:
- Modify `runtimeCaching` array
- Add/remove URL patterns
- Change cache durations
- Adjust cache strategies

### Regenerating Icons

If you update the main icon, regenerate PWA icons:

```powershell
powershell -ExecutionPolicy Bypass -File resize-icons.ps1
```

## Browser Support

- ✅ Chrome/Edge (Desktop & Mobile)
- ✅ Firefox (Desktop & Mobile)
- ✅ Safari (Desktop & Mobile, with limitations)
- ✅ Samsung Internet
- ⚠️ iOS Safari: Limited PWA support (no push notifications)

## Production Checklist

- [x] Service worker configured
- [x] Web app manifest created
- [x] PWA icons generated
- [x] Offline page created
- [x] Install prompt component added
- [x] Meta tags for PWA added to layout
- [x] Caching strategies optimized
- [x] gitignore updated for generated files

## Future Enhancements

- [ ] Add push notification support
- [ ] Implement background sync for offline transactions
- [ ] Add update notification when new version is available
- [ ] Implement share target API for sharing to the app
- [ ] Add shortcuts for common actions

## Troubleshooting

**Service worker not registering:**
- Make sure you're testing in production mode
- Check browser console for errors
- Verify manifest.json is accessible

**Install prompt not showing:**
- PWA must be served over HTTPS (or localhost)
- App must meet installability criteria
- User may have already dismissed it

**Offline mode not working:**
- Check service worker is active in DevTools
- Verify caching strategies in next.config.ts
- Ensure content is being cached (check Application > Cache Storage)
